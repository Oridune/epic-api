import type { AxiosRequestConfig, AxiosResponse, CreateAxiosDefaults } from "npm:axios";

export type ObjectId = string;

export type TCacheSetter = (key: string, value: string) => boolean | Promise<boolean>;
export type TCacheGetter = (key: string) => string | undefined | Promise<string | undefined>;
export type TCacheDelete = (key: string) => boolean | Promise<boolean>;
export type TCacheKeys = () => string[] | Promise<string[]>;

export type TSDKOptions = {
    axiosConfig?: CreateAxiosDefaults,
    cache?: {
        setter: TCacheSetter,
        getter: TCacheGetter,
        delete: TCacheDelete,
        keys?: TCacheKeys
    },
};

export type TCacheKey = string | [string, ...(string | undefined)[]];

export type TCacheOptions<T> = {
    cacheKey?: TCacheKey;
    cacheTTL?: number | ((data: T, timestamp: number) => number);
};

export type TRequestOptions<T> = {
    axiosConfig?: Omit<
        AxiosRequestConfig<unknown>,
        "method" | "url" | "data" | "params"
    >;
    signal?: AbortSignal
} & TCacheOptions<T>;

export type TResponseShape<D> = {
    status: boolean;
    data?: D;
    messages?: Array<Partial<
        { message: string, location: string }
    >>
};

export type TRequestExecutors<R extends TResponseShape<any>, B = any> = {
    raw: Promise<AxiosResponse<R, B>>;
    res: Promise<R>;
    data: Promise<R["data"]>;
    then: Promise<R["data"]>["then"];
    catch: Promise<R["data"]>["catch"];
    finally: Promise<R["data"]>["finally"];
}